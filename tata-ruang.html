<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Tata Ruang dan Jasa Konstruksi 2026-2030</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .currency-cell { text-align: right; font-feature-settings: "tnum"; font-variant-numeric: tabular-nums; white-space: nowrap; }
        
        /* Custom Scrollbar for Table */
        .custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

        @media print {
            @page { size: landscape; margin: 10mm; }
            body { background-color: white; font-size: 11px; }
            .no-print { display: none !important; }
            .card { box-shadow: none !important; border: 1px solid #ddd !important; break-inside: avoid; margin-bottom: 10px; }
            /* Force background printing */
            .bg-blue-900, .bg-blue-50, .bg-gray-100, .bg-gray-50 { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            /* Adjust table for print */
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ccc; padding: 4px 8px !important; }
            /* Hide chart containers if they take too much space, or resize them */
            .chart-container { height: 300px !important; page-break-inside: avoid; }
            /* Ensure text is black */
            .text-gray-500, .text-gray-600, .text-gray-700 { color: #000 !important; }
        }
    </style>
</head>
<body class="text-gray-800">
<nav class="no-print bg-white border-b border-slate-200 shadow-sm sticky top-0 z-[60]">
    <div class="max-w-[98%] mx-auto px-4">
        <div class="flex flex-wrap items-center justify-between py-2 gap-4">
            <a href="index.html" class="flex items-center gap-2 text-slate-800 hover:text-blue-600 font-black text-sm uppercase tracking-tighter">
                <i class="fa-solid fa-house-chimney"></i> 
                <span>Dashboard Utama</span>
            </a>

            <div class="flex flex-wrap gap-2 md:gap-4">
                <a href="bina-marga.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-500 hover:text-white">
                    <i class="fa-solid fa-road mr-1"></i> Bina Marga
                </a>
                <a href="cipta-karya.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-500 hover:text-white">
                    <i class="fa-solid fa-city mr-1"></i> Cipta Karya
                </a>
                <a href="sda.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-cyan-200 bg-cyan-50 text-cyan-700 hover:bg-cyan-500 hover:text-white">
                    <i class="fa-solid fa-water mr-1"></i> SDA
                </a>
                <a href="tata-ruang.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-500 hover:text-white">
                    <i class="fa-solid fa-map mr-1"></i> Tata Ruang
                </a>
            </div>
        </div>
    </div>
</nav>
    <!-- Navbar -->
    <nav class="bg-slate-900 text-white shadow-lg sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-500 p-2 rounded-lg">
                        <i class="fa-solid fa-chart-pie text-white"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-base leading-tight">Tata Ruang Dan Jasa Konstruksi</span>
                        <span class="text-xs text-blue-200 font-light">Periode 2026-2030</span>
                    </div>
                </div>
                <div>
                    <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium transition shadow-md flex items-center gap-2">
                        <i class="fa-solid fa-print"></i> 
                        <span>Cetak Laporan (PDF)</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-[95%] mx-auto px-2 sm:px-4 lg:px-6 py-8">
        
        <!-- Summary Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-blue-500"></div>
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Total Pagu (5 Tahun)</p>
                        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mt-1 tracking-tight" id="totalBudget">Rp 0</h3>
                    </div>
                    <div class="p-2 bg-blue-50 rounded-lg text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                        <i class="fa-solid fa-money-bill-wave"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-green-500"></div>
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Total Kegiatan</p>
                        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mt-1" id="totalActivities">0</h3>
                    </div>
                    <div class="p-2 bg-green-50 rounded-lg text-green-600 group-hover:bg-green-600 group-hover:text-white transition-colors duration-300">
                        <i class="fa-solid fa-list-check"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-purple-500"></div>
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Puncak Anggaran</p>
                        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mt-1" id="peakYear">-</h3>
                    </div>
                    <div class="p-2 bg-purple-50 rounded-lg text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition-colors duration-300">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-orange-500"></div>
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Sumber Dana</p>
                        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mt-1">APBD</h3>
                    </div>
                    <div class="p-2 bg-orange-50 rounded-lg text-orange-600 group-hover:bg-orange-600 group-hover:text-white transition-colors duration-300">
                        <i class="fa-solid fa-building-columns"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Trend Chart -->
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 card chart-container">
                <div class="flex justify-between items-center mb-4 border-b border-gray-100 pb-2">
                    <h4 class="text-base font-bold text-gray-700">Tren Pagu Indikatif</h4>
                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">5 Tahun</span>
                </div>
                <div class="relative h-64 w-full">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
            
            <!-- Category Chart -->
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 card chart-container">
                <div class="flex justify-between items-center mb-4 border-b border-gray-100 pb-2">
                    <h4 class="text-base font-bold text-gray-700">Proporsi Anggaran per Tujuan</h4>
                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">Distribusi</span>
                </div>
                <div class="relative h-64 w-full">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Detailed Table -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden card">
            <div class="px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-center bg-gray-50 gap-2">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-table text-blue-600"></i>
                    <h3 class="text-lg font-bold text-gray-800">Matriks Rencana Aksi & Anggaran</h3>
                </div>
                <div class="flex gap-2">
                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded border border-blue-200 font-medium">Satuan: Rupiah (Rp)</span>
                </div>
            </div>
            
            <div class="overflow-x-auto custom-scrollbar max-h-[800px]">
                <table class="min-w-full divide-y divide-gray-200 text-sm border-collapse">
                    <thead class="bg-gray-100 sticky top-0 z-10 shadow-sm">
                        <tr>
                            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider w-1/3 bg-gray-100 border-b-2 border-gray-300">
                                Tujuan & Rencana Aksi
                            </th>
                            <th scope="col" class="px-3 py-4 text-right text-xs font-bold text-gray-600 uppercase tracking-wider bg-gray-100 border-b-2 border-gray-300">2026</th>
                            <th scope="col" class="px-3 py-4 text-right text-xs font-bold text-gray-600 uppercase tracking-wider bg-gray-100 border-b-2 border-gray-300">2027</th>
                            <th scope="col" class="px-3 py-4 text-right text-xs font-bold text-gray-600 uppercase tracking-wider bg-gray-100 border-b-2 border-gray-300">2028</th>
                            <th scope="col" class="px-3 py-4 text-right text-xs font-bold text-gray-600 uppercase tracking-wider bg-gray-100 border-b-2 border-gray-300">2029</th>
                            <th scope="col" class="px-3 py-4 text-right text-xs font-bold text-gray-600 uppercase tracking-wider bg-gray-100 border-b-2 border-gray-300">2030</th>
                            <th scope="col" class="px-4 py-4 text-right text-xs font-bold text-blue-700 uppercase tracking-wider bg-blue-50 border-b-2 border-blue-200">Total 5 Thn</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="tableBody">
                        <!-- Data will be injected here via JS -->
                    </tbody>
                    <tfoot class="bg-slate-50 font-bold text-gray-800 sticky bottom-0 shadow-[0_-2px_4px_rgba(0,0,0,0.1)]">
                        <tr class="bg-slate-100">
                            <td class="px-6 py-4 text-gray-900 border-t-2 border-gray-300">TOTAL KESELURUHAN</td>
                            <td class="px-3 py-4 text-right currency-cell border-t-2 border-gray-300" id="footer2026">0</td>
                            <td class="px-3 py-4 text-right currency-cell border-t-2 border-gray-300" id="footer2027">0</td>
                            <td class="px-3 py-4 text-right currency-cell border-t-2 border-gray-300" id="footer2028">0</td>
                            <td class="px-3 py-4 text-right currency-cell border-t-2 border-gray-300" id="footer2029">0</td>
                            <td class="px-3 py-4 text-right currency-cell border-t-2 border-gray-300" id="footer2030">0</td>
                            <td class="px-4 py-4 text-right currency-cell bg-blue-50 text-blue-800 border-t-2 border-blue-200" id="footerTotal">0</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        
        <div class="mt-6 text-center text-gray-400 text-xs no-print">
            <p>Sistem Perencanaan Terpadu &copy; 2025. Data bersifat indikatif dan dapat berubah.</p>
        </div>

    </main>

    <script>
        // --- DATA PREPARATION ---
        const rawData = [
            {
                objective: "Meningkatnya persentase wilayah yang telah mempunyai rencana detail tata ruang",
                items: [
                    { action: "Pelaksanaan Persetujuan Substansi RTRW Kabupaten/Kota", budget: [161265182, 0, 0, 0, 0] },
                    { action: "Pelaksanaan Evaluasi dan Konsultasi Evaluasi RTRW Kabupaten/Kota", budget: [11232700, 0, 0, 0, 0] },
                    { action: "Penetapan RTRW Kabupaten/Kota", budget: [13904000, 0, 0, 0, 0] },
                    { action: "Penetapan RDTR Kabupaten/kota", budget: [14612000, 15780960, 17043437, 18406912, 19879465] },
                    { action: "Pelaksanaan Persetujuan Substabsi RDTR Kabupaten/Kota", budget: [373719182, 404696717, 437072454, 472038250, 509801310] }
                ]
            },
            {
                objective: "Meningkatnya keselarasan rencana tata ruang daerah Kabupaten/Kota dengan rencana pembangunan",
                items: [
                    { action: "Pelaksanaan Penyusunan RDTR Kabupaten/Kota", budget: [875580000, 969732000, 1047310560, 1131095405, 1221583037] }
                ]
            },
            {
                objective: "Meningkatnya kegiatan Pengendalian Tata Ruang Wilayah",
                items: [
                    { action: "Koordinasi Penyelenggaraan Penataan Ruang", budget: [148383000, 199686600, 215661528, 232914450, 251547606] }
                ]
            },
            {
                objective: "Meningkatnya kualitas tenaga kerja konstruksi",
                items: [
                    { action: "Fasilitasi Sertifikasi Tenaga Kerja Konstruksi (Operator/Teknisi/Analis)", budget: [2901550, 3133674, 3384368, 3655117, 3947527] },
                    { action: "Pemantauan dan Evaluasi Pelatihan Tenaga Kerja Konstruksi", budget: [8746000, 9445680, 10201335, 11017442, 11898836] },
                    { action: "Pelatihan Tenaga Kerja Konstruksi", budget: [348447910, 370599743, 400247722, 432267540, 466848943] },
                    { action: "Penyediaan Training Need Assessment (TNA)", budget: [17054362, 25090735, 27097994, 29265833, 31607100] },
                    { action: "Penyediaan Instruktur/Asesor/Penyelenggara Pelatihan", budget: [64500000, 76140000, 82231200, 88809696, 95914472] }
                ]
            },
            {
                objective: "Meningkatnya Sistem Informasi Jasa Konstruksi cakupan daerah Kabupaten/kota",
                items: [
                    { action: "Penyediaan Data dan Informasi Jasa Konstruksi", budget: [67324780, 114825362, 124011391, 133932303, 144646887] },
                    { action: "Peningkatan Kapasitas Pengelola SIPJAKI", budget: [6599850, 7373430, 7963304, 8600369, 9288399] }
                ]
            },
            {
                objective: "Meningkatnya Pengawasan Tertib Usaha, Tertib Penyelenggara Dan Tertib Pemanfaatan Jasa Konstruksi",
                items: [
                    { action: "Pengawasan dan Evaluasi Tertib Usaha Jasa Konstruksi", budget: [12214000, 13191120, 14246410, 15386122, 16617011] },
                    { action: "Pengawasan dan Evaluasi Tertib Penyelenggaraan Jasa Konstruksi", budget: [91100010, 103464011, 111741132, 120680422, 130334856] },
                    { action: "Pengawasan dan Evaluasi Tertib Pemanfaatan Produk Jasa Konstruksi", budget: [103011040, 111251923, 120152077, 129764243, 140145383] }
                ]
            }
        ];

        // --- HELPER FUNCTIONS ---
        const formatIDR = (num) => {
            if (num === 0) return `<span class="text-gray-300">-</span>`;
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num).replace("Rp", "");
        };

        const formatIDRFull = (num) => {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num);
        };

        const sumArray = (arr) => arr.reduce((a, b) => a + b, 0);

        // --- MAIN LOGIC ---
        
        let totalPerYear = [0, 0, 0, 0, 0]; // 2026-2030
        let totalPerObjective = [];
        let grandTotal = 0;
        let activityCount = 0;

        const tbody = document.getElementById('tableBody');

        rawData.forEach((group, index) => {
            let groupTotal = 0;
            
            // Render Group Header (Sticky logic handled by sequence, but visual separation enhanced)
            const headerRow = document.createElement('tr');
            headerRow.className = "bg-slate-100 break-inside-avoid"; 
            headerRow.innerHTML = `
                <td colspan="7" class="px-6 py-3 text-sm font-bold text-slate-700 border-t border-b border-slate-200">
                    <div class="flex items-center gap-2">
                        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-slate-200 text-xs text-slate-600">${index + 1}</span>
                        <span>${group.objective}</span>
                    </div>
                </td>
            `;
            tbody.appendChild(headerRow);

            group.items.forEach(item => {
                activityCount++;
                const itemTotal = sumArray(item.budget);
                groupTotal += itemTotal;
                
                // Add to yearly totals
                item.budget.forEach((val, i) => totalPerYear[i] += val);

                // Render Item Row
                const row = document.createElement('tr');
                row.className = "hover:bg-blue-50 transition group border-b border-gray-100";
                
                // Determine styling for zero values
                const cells = item.budget.map(val => 
                    `<td class="px-3 py-3 currency-cell ${val === 0 ? 'text-gray-300' : 'text-gray-700 font-medium'}">${formatIDR(val)}</td>`
                ).join('');

                row.innerHTML = `
                    <td class="px-6 py-3 text-gray-600 text-sm pl-10 border-l-4 border-transparent hover:border-blue-400 group-hover:text-blue-800">
                        ${item.action}
                    </td>
                    ${cells}
                    <td class="px-4 py-3 currency-cell font-bold text-blue-700 bg-blue-50/30 border-l border-blue-100">${formatIDR(itemTotal)}</td>
                `;
                tbody.appendChild(row);
            });

            totalPerObjective.push(groupTotal);
        });

        grandTotal = sumArray(totalPerYear);

        // --- UPDATE SUMMARY CARDS ---
        document.getElementById('totalBudget').innerText = formatIDRFull(grandTotal);
        document.getElementById('totalActivities').innerText = activityCount;
        
        const maxYearVal = Math.max(...totalPerYear);
        const maxYearIndex = totalPerYear.indexOf(maxYearVal);
        document.getElementById('peakYear').innerText = (2026 + maxYearIndex);

        // --- UPDATE TABLE FOOTER ---
        document.getElementById('footer2026').innerText = formatIDRFull(totalPerYear[0]).replace("Rp", "");
        document.getElementById('footer2027').innerText = formatIDRFull(totalPerYear[1]).replace("Rp", "");
        document.getElementById('footer2028').innerText = formatIDRFull(totalPerYear[2]).replace("Rp", "");
        document.getElementById('footer2029').innerText = formatIDRFull(totalPerYear[3]).replace("Rp", "");
        document.getElementById('footer2030').innerText = formatIDRFull(totalPerYear[4]).replace("Rp", "");
        document.getElementById('footerTotal').innerText = formatIDRFull(grandTotal).replace("Rp", "");

        // --- CHARTS CONFIGURATION ---
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#64748b';

        // 1. Line Chart (Trend)
        const ctxTrend = document.getElementById('trendChart').getContext('2d');
        
        // Create gradient
        const gradient = ctxTrend.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(59, 130, 246, 0.5)'); // Blue start
        gradient.addColorStop(1, 'rgba(59, 130, 246, 0.0)'); // Transparent end

        new Chart(ctxTrend, {
            type: 'line',
            data: {
                labels: ['2026', '2027', '2028', '2029', '2030'],
                datasets: [{
                    label: 'Pagu Anggaran',
                    data: totalPerYear,
                    borderColor: '#3b82f6',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2563eb',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        padding: 12,
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont: { size: 13 },
                        callbacks: {
                            label: function(context) {
                                return formatIDRFull(context.raw);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { borderDash: [2, 2], drawBorder: false },
                        ticks: {
                            callback: function(value) {
                                return (value / 1000000000).toFixed(1) + ' M';
                            }
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // 2. Doughnut Chart (Category Distribution)
        const shortLabels = [
            "RTRW/RDTR Wilayah",
            "Keselarasan",
            "Pengendalian Ruang",
            "Tenaga Kerja",
            "Sistem Informasi",
            "Pengawasan Tertib"
        ];

        const ctxCat = document.getElementById('categoryChart').getContext('2d');
        new Chart(ctxCat, {
            type: 'doughnut',
            data: {
                labels: shortLabels,
                datasets: [{
                    data: totalPerObjective,
                    backgroundColor: [
                        '#3b82f6', // blue-500
                        '#10b981', // emerald-500
                        '#f59e0b', // amber-500
                        '#8b5cf6', // violet-500
                        '#ec4899', // pink-500
                        '#6366f1'  // indigo-500
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '65%',
                plugins: {
                    legend: {
                        position: 'right',
                        labels: { 
                            boxWidth: 10, 
                            usePointStyle: true,
                            pointStyle: 'circle',
                            font: { size: 11 } 
                        }
                    },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                let value = context.raw;
                                let percentage = (value / grandTotal * 100).toFixed(1) + '%';
                                return ' ' + percentage;
                            },
                            afterLabel: function(context) {
                                return ' ' + formatIDRFull(context.raw);
                            }
                        }
                    }
                }
            }
        });

    </script>
</body>
</html>