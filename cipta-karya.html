<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Rencana Cipta Karya 2026-2030</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .currency-cell { text-align: right; font-feature-settings: "tnum"; font-variant-numeric: tabular-nums; white-space: nowrap; }
        
        .custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

        @media print {
            @page { size: landscape; margin: 5mm; }
            body { background-color: white; font-size: 10px; }
            .no-print { display: none !important; }
            .card { box-shadow: none !important; border: 1px solid #ddd !important; break-inside: avoid; margin-bottom: 10px; }
            .bg-emerald-900, .bg-emerald-600, .bg-gray-100, .bg-gray-50 { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ccc; padding: 2px 4px !important; }
        }
    </style>
</head>
<body class="text-gray-800">
<nav class="no-print bg-white border-b border-slate-200 shadow-sm sticky top-0 z-[60]">
    <div class="max-w-[98%] mx-auto px-4">
        <div class="flex flex-wrap items-center justify-between py-2 gap-4">
            <a href="index.html" class="flex items-center gap-2 text-slate-800 hover:text-blue-600 font-black text-sm uppercase tracking-tighter">
                <i class="fa-solid fa-house-chimney"></i> 
                <span>Dashboard Utama</span>
            </a>

            <div class="flex flex-wrap gap-2 md:gap-4">
                <a href="bina-marga.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-500 hover:text-white">
                    <i class="fa-solid fa-road mr-1"></i> Bina Marga
                </a>
                <a href="cipta-karya.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-500 hover:text-white">
                    <i class="fa-solid fa-city mr-1"></i> Cipta Karya
                </a>
                <a href="sda.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-cyan-200 bg-cyan-50 text-cyan-700 hover:bg-cyan-500 hover:text-white">
                    <i class="fa-solid fa-water mr-1"></i> SDA
                </a>
                <a href="tata-ruang.html" class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all border border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-500 hover:text-white">
                    <i class="fa-solid fa-map mr-1"></i> Tata Ruang
                </a>
            </div>
        </div>
    </div>
</nav>
    <!-- Navbar -->
    <nav class="bg-emerald-900 text-white shadow-lg sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-emerald-600 p-2 rounded-lg shadow-inner">
                        <i class="fa-solid fa-city text-white"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-base leading-tight">Rencana Cipta Karya</span>
                        <span class="text-xs text-emerald-200 font-light">Dinas PUPR - Periode 2026-2030</span>
                    </div>
                </div>
                <div>
                    <button onclick="window.print()" class="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded-md text-sm font-medium transition shadow-md flex items-center gap-2">
                        <i class="fa-solid fa-print"></i> 
                        <span>Cetak Laporan</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-[95%] mx-auto px-2 sm:px-4 lg:px-6 py-8">
        
        <!-- Summary Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-emerald-500"></div>
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Total Pagu (2026-2030)</p>
                    <h3 class="text-xl md:text-2xl font-bold text-gray-800 mt-1 tracking-tight" id="totalBudget">Rp 0</h3>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-blue-500"></div>
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Total Kegiatan</p>
                    <h3 class="text-xl md:text-2xl font-bold text-gray-800 mt-1" id="totalActivities">0</h3>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-amber-500"></div>
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Tahun Puncak</p>
                    <h3 class="text-xl md:text-2xl font-bold text-gray-800 mt-1" id="peakYear">-</h3>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-100 card relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1 bg-purple-500"></div>
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Fokus Program</p>
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mt-1">Gedung & Sanitasi</h3>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 card">
                <h4 class="text-sm font-bold text-gray-700 mb-4 uppercase tracking-wider">Tren Anggaran 2026-2030</h4>
                <div class="relative h-64 w-full">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
            
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 card">
                <h4 class="text-sm font-bold text-gray-700 mb-4 uppercase tracking-wider">Proporsi Sektor Anggaran</h4>
                <div class="relative h-64 w-full">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Detailed Table -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden card">
            
            <div class="px-6 py-4 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center bg-gray-50 gap-4">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-table text-emerald-600"></i>
                    <h3 class="text-lg font-bold text-gray-800">Matriks Rencana Aksi (Update 2030)</h3>
                </div>
                
                <!-- Year Tabs -->
                <div class="flex flex-wrap gap-1 p-1 bg-gray-200 rounded-lg no-print">
                    <button onclick="renderTable('all')" id="btn-all" class="px-3 py-1.5 text-xs font-semibold rounded-md shadow-sm transition-all bg-white text-emerald-700">Semua</button>
                    <button onclick="renderTable('2026')" id="btn-2026" class="px-3 py-1.5 text-xs font-semibold rounded-md transition-all text-gray-600 hover:bg-white">2026</button>
                    <button onclick="renderTable('2027')" id="btn-2027" class="px-3 py-1.5 text-xs font-semibold rounded-md transition-all text-gray-600 hover:bg-white">2027</button>
                    <button onclick="renderTable('2028')" id="btn-2028" class="px-3 py-1.5 text-xs font-semibold rounded-md transition-all text-gray-600 hover:bg-white">2028</button>
                    <button onclick="renderTable('2029')" id="btn-2029" class="px-3 py-1.5 text-xs font-semibold rounded-md transition-all text-gray-600 hover:bg-white">2029</button>
                    <button onclick="renderTable('2030')" id="btn-2030" class="px-3 py-1.5 text-xs font-semibold rounded-md transition-all text-gray-600 hover:bg-white">2030</button>
                </div>
            </div>
            
            <div class="overflow-x-auto custom-scrollbar">
                <table class="min-w-full divide-y divide-gray-200 text-sm border-collapse">
                    <thead class="bg-gray-100" id="tableHead"></thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="tableBody"></tbody>
                    <tfoot class="bg-slate-50 font-bold text-gray-800" id="tableFoot"></tfoot>
                </table>
            </div>
        </div>

    </main>

    <script>
        // --- DATASET (Updated to include detailed 2030 data) ---
        // Budget structure: [2026, 2027, 2028, 2029, 2030]
        
        const rawData = [
            {
                objective: "BANGUNAN GEDUNG: Peningkatan Standar Keselamatan & Kelayakan",
                items: [
                    { action: "Pembangunan Gedung Aula Rakat Mufakat (Lanjutan)", budget: [14782780000, 0, 0, 0, 0] },
                    { action: "Pembangunan Kantor dan Gedung Diklat BKPSDM", budget: [8000000000, 8000000000, 0, 0, 0] },
                    { action: "Pembangunan Mal Pelayanan Publik di Negara", budget: [3500000000, 5000000000, 0, 0, 0] },
                    { action: "Pembangunan Gedung Kesenian Kab. HSS (Lanjutan)", budget: [0, 0, 0, 7000000000, 3500000000] },
                    { action: "Pembangunan Kawasan Kuliner Bantaran Sungai Amandit (Lanjutan)", budget: [0, 15000000000, 0, 0, 7000000000] },
                    { action: "Pembangunan Jalan Utama Masuk di Kawasan Perkantoran Kab. HSS (Lanjutan)", budget: [0, 15000000000, 0, 0, 10000000000] },
                    { action: "Pembangunan RTH Kawasan Islamic Center (Lanjutan)", budget: [0, 0, 10000000000, 0, 3000000000] },
                    { action: "Pembangunan Kantor Dinas Pendidikan", budget: [0, 0, 8500000000, 0, 0] },
                    { action: "Fasilitas Kesehatan RSUD (Pusat Trauma/ICU)", budget: [13000000000, 0, 0, 0, 0] },
                    { action: "Gedung PKK & Dekranasda (Pembangunan & Rehab)", budget: [6000000000, 0, 0, 5000000000, 0] }
                ]
            },
            {
                objective: "SANITASI: Layanan Sanitasi Layak & Standar Kesehatan",
                items: [
                    { action: "Peningkatan Kawasan TPA Malutu Tahap 2", budget: [7000000000, 0, 0, 0, 0] },
                    { action: "Program Gebrak Sehati & Rehab IPLT", budget: [1473850000, 690000000, 0, 0, 0] },
                    { action: "Paket Pembangunan SPALD-S Perdesaan (Kolektif 2026)", budget: [3273060000, 0, 0, 0, 0] },
                    { action: "Paket Pembangunan SPALD-S Perdesaan (Kolektif 2027)", budget: [0, 5971954217, 0, 0, 0] },
                    { action: "Paket Pembangunan SPALD-S Perdesaan (Kolektif 2028)", budget: [0, 0, 7055740434, 0, 0] },
                    { action: "Paket Pembangunan SPALD-S Perdesaan (Kolektif 2029)", budget: [0, 0, 0, 7558667527, 0] },
                    // Rincian 2030
                    { action: "Pembangunan SPALD-S di Desa Tawia (50 Unit)", budget: [0, 0, 0, 0, 642512433] },
                    { action: "Pembangunan SPALD-S di Desa Paring Agung (50 Unit)", budget: [0, 0, 0, 0, 642512433] },
                    { action: "Pembangunan SPALD-S di Desa Telaga Sili-Sili (50 Unit)", budget: [0, 0, 0, 0, 642512433] },
                    { action: "Pembangunan SPALD-S di Desa Pandulangan (50 Unit)", budget: [0, 0, 0, 0, 642512433] }
                ]
            },
            {
                objective: "AIR BERSIH: Sistem Distribusi & Akses Layanan Air Bersih",
                items: [
                    { action: "Tapping Pipa Intake Malutu ke Muara Banta", budget: [9000000000, 0, 0, 0, 0] },
                    { action: "Pembangunan IPA & Jaringan Perpipaan Hamayung (APBN)", budget: [0, 9200000000, 0, 0, 0] },
                    { action: "Pergantian Jaringan Pipa Perkotaan Kandangan (APBN)", budget: [0, 11500000000, 0, 0, 0] },
                    { action: "Peningkatan SPAM Jaringan Perpipaan (Kolektif 2026)", budget: [3920060000, 0, 0, 0, 0] },
                    { action: "Peningkatan SPAM Jaringan Perpipaan (Kolektif 2027)", budget: [0, 4215000000, 0, 0, 0] },
                    { action: "Peningkatan SPAM Jaringan Perpipaan (Kolektif 2028)", budget: [0, 0, 2535000000, 0, 0] },
                    { action: "Peningkatan SPAM Jaringan Perpipaan (Kolektif 2029)", budget: [0, 0, 0, 2520000000, 0] },
                    // Rincian 2030
                    { action: "Pembangunan SPAM di Desa Siang Gantung Kec. Daha Barat (50 SR)", budget: [0, 0, 0, 0, 420000000] },
                    { action: "Pembangunan SPAM di Desa Sungai Garuda Kec. Daha Utara (50 SR)", budget: [0, 0, 0, 0, 420000000] },
                    { action: "Pembangunan SPAM di Desa Garunggang Kec. Simpur (50 SR)", budget: [0, 0, 0, 0, 420000000] },
                    { action: "Pembangunan SPAM di Desa Hamayung Kec. Daha Utara (50 SR)", budget: [0, 0, 0, 0, 420000000] }
                ]
            }
        ];

        // --- CORE FUNCTIONS ---
        const formatIDR = (num) => {
            if (num === 0) return `<span class="text-gray-300">-</span>`;
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num).replace("Rp", "");
        };

        const formatFull = (num) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num);

        let totalPerYear = [0, 0, 0, 0, 0];
        let totalPerObjective = [];
        let grandTotal = 0;
        let activityCount = 0;

        rawData.forEach(group => {
            let groupTotal = 0;
            group.items.forEach(item => {
                activityCount++;
                const itemTotal = item.budget.reduce((a, b) => a + b, 0);
                groupTotal += itemTotal;
                item.budget.forEach((val, i) => totalPerYear[i] += val);
            });
            totalPerObjective.push(groupTotal);
        });
        grandTotal = totalPerYear.reduce((a, b) => a + b, 0);

        function renderTable(filterMode) {
            document.querySelectorAll('button[id^="btn-"]').forEach(btn => btn.className = "px-3 py-1.5 text-xs font-semibold rounded-md transition-all text-gray-600 hover:bg-white");
            document.getElementById(`btn-${filterMode}`).className = "px-3 py-1.5 text-xs font-semibold rounded-md shadow-sm transition-all bg-white text-emerald-700 ring-1 ring-gray-200";

            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');
            const tfoot = document.getElementById('tableFoot');
            
            tbody.innerHTML = '';
            let colIndices = (filterMode === 'all') ? [0, 1, 2, 3, 4] : [{'2026':0, '2027':1, '2028':2, '2029':3, '2030':4}[filterMode]];

            // Header
            let headHTML = `<tr><th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider w-1/3">Rencana Aksi</th>`;
            colIndices.forEach(idx => headHTML += `<th class="px-3 py-4 text-right text-xs font-bold text-gray-600 uppercase tracking-wider">${2026+idx}</th>`);
            headHTML += `<th class="px-4 py-4 text-right text-xs font-bold text-emerald-700 uppercase tracking-wider bg-emerald-50">Total</th></tr>`;
            thead.innerHTML = headHTML;

            // Body
            rawData.forEach((group, gIdx) => {
                // Filter rows for specific year if selected
                let visibleItems = group.items;
                if (filterMode !== 'all') {
                    const idx = {'2026':0, '2027':1, '2028':2, '2029':3, '2030':4}[filterMode];
                    visibleItems = group.items.filter(item => item.budget[idx] > 0);
                }

                if (visibleItems.length > 0) {
                    const hRow = document.createElement('tr');
                    hRow.className = "bg-slate-100 font-bold text-emerald-800";
                    hRow.innerHTML = `<td colspan="${colIndices.length + 2}" class="px-6 py-2 text-xs uppercase">${gIdx+1}. ${group.objective}</td>`;
                    tbody.appendChild(hRow);

                    visibleItems.forEach(item => {
                        const rowTotal = item.budget.reduce((a, b) => a + b, 0);
                        let cells = colIndices.map(idx => `<td class="px-3 py-3 currency-cell">${formatIDR(item.budget[idx])}</td>`).join('');
                        const row = document.createElement('tr');
                        row.className = "hover:bg-emerald-50 border-b border-gray-100";
                        row.innerHTML = `<td class="px-6 py-3 text-gray-600 text-xs pl-8">${item.action}</td>${cells}<td class="px-4 py-3 currency-cell font-bold bg-emerald-50/30">${formatIDR(filterMode === 'all' ? rowTotal : item.budget[colIndices[0]])}</td>`;
                        tbody.appendChild(row);
                    });
                }
            });

            // Footer
            let footHTML = `<tr class="bg-slate-200 text-gray-900"><td class="px-6 py-4">TOTAL</td>`;
            colIndices.forEach(idx => footHTML += `<td class="px-3 py-4 text-right currency-cell">${formatIDR(totalPerYear[idx])}</td>`);
            const totalDisplay = filterMode === 'all' ? grandTotal : totalPerYear[{'2026':0, '2027':1, '2028':2, '2029':3, '2030':4}[filterMode]];
            footHTML += `<td class="px-4 py-4 text-right currency-cell text-emerald-800 font-black">${formatIDR(totalDisplay)}</td></tr>`;
            tfoot.innerHTML = footHTML;
        }

        // --- STATS & CHARTS ---
        window.onload = function() {
            document.getElementById('totalBudget').innerText = formatFull(grandTotal);
            document.getElementById('totalActivities').innerText = activityCount;
            const peakIdx = totalPerYear.indexOf(Math.max(...totalPerYear));
            document.getElementById('peakYear').innerText = 2026 + peakIdx;

            new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: ['2026', '2027', '2028', '2029', '2030'],
                    datasets: [{
                        label: 'Anggaran',
                        data: totalPerYear,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 5
                    }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { ticks: { callback: v => (v/1e9).toFixed(1) + ' M' } } }
                }
            });

            new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Gedung', 'Sanitasi', 'Air Bersih'],
                    datasets: [{
                        data: totalPerObjective,
                        backgroundColor: ['#10b981', '#f59e0b', '#3b82f6']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            renderTable('all');
        }
    </script>
</body>
</html>